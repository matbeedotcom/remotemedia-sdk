{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://remotemedia.dev/schemas/manifest.v1.json",
  "title": "RemoteMedia Pipeline Manifest",
  "description": "JSON manifest format for language-neutral RemoteMedia pipeline execution",
  "type": "object",
  "required": ["version", "metadata", "nodes", "connections"],
  "properties": {
    "version": {
      "type": "string",
      "const": "v1",
      "description": "Manifest schema version"
    },
    "metadata": {
      "$ref": "#/definitions/ManifestMetadata"
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/NodeManifest"
      },
      "description": "List of processing nodes in the pipeline"
    },
    "connections": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Connection"
      },
      "description": "Data flow connections between nodes"
    }
  },
  "definitions": {
    "ManifestMetadata": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Pipeline name (unique identifier)",
          "minLength": 1,
          "maxLength": 255
        },
        "description": {
          "type": "string",
          "description": "Optional human-readable description"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation"
        }
      }
    },
    "NodeManifest": {
      "type": "object",
      "required": ["id", "node_type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique node identifier within the pipeline",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "node_type": {
          "type": "string",
          "description": "Node type identifier (e.g., AudioTransform, HFPipelineNode)",
          "minLength": 1
        },
        "params": {
          "type": "object",
          "description": "Node-specific configuration parameters",
          "default": {}
        },
        "capabilities": {
          "$ref": "#/definitions/CapabilityRequirements",
          "description": "Optional resource requirements for node execution"
        },
        "host": {
          "type": "string",
          "description": "Optional remote execution host (e.g., 'localhost:50051')",
          "pattern": "^[^:]+:\\d+$"
        }
      }
    },
    "CapabilityRequirements": {
      "type": "object",
      "properties": {
        "gpu": {
          "$ref": "#/definitions/GpuRequirement"
        },
        "cpu": {
          "$ref": "#/definitions/CpuRequirement"
        },
        "memory_gb": {
          "type": "number",
          "minimum": 0,
          "description": "Required memory in gigabytes"
        }
      }
    },
    "GpuRequirement": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["cuda", "rocm", "metal", "vulkan", "any"],
          "description": "GPU runtime type"
        },
        "min_memory_gb": {
          "type": "number",
          "minimum": 0,
          "description": "Minimum GPU memory in gigabytes"
        },
        "required": {
          "type": "boolean",
          "default": true,
          "description": "Whether GPU is required (true) or optional (false)"
        }
      }
    },
    "CpuRequirement": {
      "type": "object",
      "properties": {
        "cores": {
          "type": "integer",
          "minimum": 1,
          "description": "Minimum number of CPU cores"
        },
        "arch": {
          "type": "string",
          "enum": ["x86_64", "aarch64", "arm", "any"],
          "description": "CPU architecture preference"
        }
      }
    },
    "Connection": {
      "type": "object",
      "required": ["from", "to"],
      "properties": {
        "from": {
          "type": "string",
          "description": "Source node ID",
          "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "to": {
          "type": "string",
          "description": "Target node ID",
          "pattern": "^[a-zA-Z0-9_-]+$"
        }
      }
    }
  },
  "examples": [
    {
      "version": "v1",
      "metadata": {
        "name": "audio-pipeline",
        "description": "Simple audio processing pipeline",
        "created_at": "2025-10-22T12:00:00Z"
      },
      "nodes": [
        {
          "id": "input_0",
          "node_type": "AudioSource",
          "params": {
            "sample_rate": 16000
          }
        },
        {
          "id": "transform_1",
          "node_type": "AudioTransform",
          "params": {
            "effect": "normalize"
          },
          "capabilities": {
            "cpu": {
              "cores": 2
            },
            "memory_gb": 1.0
          }
        },
        {
          "id": "transcribe_2",
          "node_type": "WhisperNode",
          "params": {
            "model": "base"
          },
          "capabilities": {
            "gpu": {
              "type": "cuda",
              "min_memory_gb": 4.0,
              "required": false
            },
            "memory_gb": 8.0
          },
          "host": "gpu-server:50051"
        }
      ],
      "connections": [
        {
          "from": "input_0",
          "to": "transform_1"
        },
        {
          "from": "transform_1",
          "to": "transcribe_2"
        }
      ]
    }
  ]
}
