# SRT Subtitle Transcription Pipeline
# Usage: remotemedia run transcribe-srt.yaml -i audio.wav -O subtitles.srt
#
# Or use the standalone binary:
#   transcribe-srt -i input.mp4 -o subtitles.srt
#
# Outputs SRT format subtitles with timestamps:
#   1
#   00:00:01,000 --> 00:00:04,500
#   Hello, this is the first subtitle.
#
#   2
#   00:00:05,000 --> 00:00:08,200
#   And this is the second one.

version: v1
metadata:
  name: transcribe-srt
  description: Audio transcription to SRT subtitle format using Whisper

# Default audio settings - can be overridden via CLI
defaults:
  sample_rate: 16000
  channels: 1

nodes:
  # Auto-resample audio to 16kHz for Whisper
  # Automatically detects input sample rate (e.g., 48kHz stereo from mic)
  - id: resample
    node_type: AutoResampleNode
    params:
      target_rate: 16000
      quality: medium  # low, medium, or high

  # Whisper speech-to-text
  # NOTE: Must use QUANTIZED model for word-level timestamps (DTW alignment)
  # Options with word timestamps: quantized_tiny, quantized_tiny_en, large-v3-turbo
  # Options without word timestamps: tiny, base, small, medium, large
  - id: whisper
    node_type: RustWhisperNode
    params:
      # These can be overridden via CLI: --model, --language, --threads
      model_source: ${MODEL:-large-v3-turbo}
      language: ${LANGUAGE:-en}
      n_threads: ${THREADS:-4}
      accumulate_chunks: false

  # Convert Whisper JSON output to SRT format
  - id: srt
    node_type: SrtOutput
    params:
      include_numbers: true
      max_line_length: 42

connections:
  - from: resample
    to: whisper
  - from: whisper
    to: srt
